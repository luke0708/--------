# ===========================================
# Infrastructure 总控工程
# Mac mini 开发 → GitHub → MacBook Air 部署
# ===========================================

services:
  # --- 监控工具: Dozzle (实时日志查看) ---
  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "39998:8080"
    restart: always

  # --- 管理面板: Infra-Dash (图形化控制中心) ---
  infra-dash:
    build: ./infra-dash
    container_name: infra-dash
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/app/scripts
    ports:
      - "39999:8000"
    restart: always

  # === 在下方添加新服务 ===

  # --- 新部署服务: News-Tracker ---
  news-tracker:
    build: ../projects/news-tracker/backend
    container_name: news-tracker
    restart: always
    ports:
      - "50003:8000"
    env_file:
      - .env
    environment:
      - DATABASE_URL=sqlite:////app/data/news.db
    volumes:
      - ../projects/news-tracker/backend/data:/app/data

volumes:
  rss-data:


networks:
  default:
    name: infra-network
