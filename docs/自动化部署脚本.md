# 自动化更新与部署脚本

## 1. 脚本文件：update.sh
在 `Infrastructure` 目录下创建名为 `update.sh` 的文件，并将以下代码复制进去。

```bash
#!/bin/bash

# =================配置区=================
# 在这里列出所有需要更新的项目文件夹名称（需与实际文件夹名一致）
PROJECTS=(
    "User-Backend"
    "Order-Backend"
    "Payment-Backend"
)
# =======================================

echo "🚀 [Start] 开始全量更新流程..."

# 1. 遍历所有项目拉取最新代码
for proj in "${PROJECTS[@]}"; do
    target_dir="../$proj"
    
    if [ -d "$target_dir" ]; then
        echo "⬇️  正在更新项目: $proj ..."
        cd "$target_dir" || exit
        
        # 强制丢弃本地修改，与远程仓库保持完全一致 (适合作为运行服务器)
        # 如果你会在 Air 上改代码，请去掉 --hard 这一行
        git fetch --all
        git reset --hard origin/main 
        git pull origin main
        
        # 回到总控目录
        cd - > /dev/null
    else
        echo "⚠️  警告: 找不到目录 $target_dir，跳过该项目。"
    fi
done

echo "✅ 所有代码已同步至最新版本。"

# 2. Docker 容器重构与重启
echo "🐳 正在重建并重启 Docker 服务..."

# --build: 强制重新构建镜像（确保依赖更新生效）
# -d: 后台运行
# --remove-orphans: 清理掉 docker-compose.yml 中已删除的旧服务
docker compose up -d --build --remove-orphans

echo "🎉 [Success] 所有后台服务已更新并正在运行！"
docker compose ps

```

## 2. 使用方法

### 首次设置权限（仅需执行一次）

打开终端，进入 `Infrastructure` 目录，运行：

```bash
chmod +x update.sh

```

### 日常更新

每当你需要在 MacBook Air 上同步 Mac mini 的最新代码时，只需运行：

```bash
./update.sh

```
